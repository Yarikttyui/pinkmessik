<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pink Messenger</title>
  <link rel="stylesheet" href="/styles.css">
  <script src="/socket.io/socket.io.js" defer></script>
  <script src="/app.js" defer></script>
</head>
<body>
  <div class="background"></div>
  <section class="auth-screen" id="authScreen">
    <div class="auth-card">
      <div class="auth-left">
        <h1>Pink Talk</h1>
  <p>Современный мессенджер в розовом стиле. Общайтесь в группах и личных чатах, делитесь файлами, реакциями и статусами.</p>
      </div>
      <div class="auth-right">
        <div class="auth-tabs">
          <button class="tab active" data-target="login">Вход</button>
          <button class="tab" data-target="register">Регистрация</button>
        </div>
        <form id="loginForm" class="form active" autocomplete="off">
          <label>Логин
            <input type="text" name="username" minlength="3" maxlength="32" required placeholder="pinkstar">
          </label>
          <label>Пароль
            <input type="password" name="password" minlength="6" required placeholder="••••••">
          </label>
          <button type="submit" class="primary">Войти</button>
          <p class="form-helper">Нет аккаунта? <span class="link" data-switch="register">Создайте его</span></p>
        </form>
        <form id="registerForm" class="form" autocomplete="off">
          <label>Логин
            <input type="text" name="username" minlength="3" maxlength="32" required placeholder="pinkstar">
          </label>
          <label>Пароль
            <input type="password" name="password" minlength="6" required placeholder="Минимум 6 символов">
          </label>
          <button type="submit" class="primary">Создать аккаунт</button>
          <p class="form-helper">Уже есть аккаунт? <span class="link" data-switch="login">Войдите</span></p>
        </form>
        <p class="form-message" id="authMessage"></p>
      </div>
    </div>
  </section>

  <div class="app-shell hidden" id="appShell">
    <aside class="sidebar">
      <div class="profile-card">
        <div class="profile-header">
          <div class="avatar" id="profileAvatar"></div>
          <div class="profile-meta">
            <h2 id="profileName"></h2>
            <p id="profileStatus"></p>
            <p class="profile-bio muted" id="profileBio"></p>
          </div>
        </div>
        <div class="profile-codes">
          <span>ID: <strong id="profileCode"></strong> <button class="ghost tiny" data-copy="profileCode">Копировать</button></span>
        </div>
        <div class="profile-actions">
          <button class="ghost" id="profileEditBtn">Редактировать</button>
          <button class="ghost" id="logoutBtn">Выйти</button>
        </div>
      </div>

      <div class="sidebar-actions">
        <button class="primary" id="newGroupBtn">+ Новая беседа</button>
        <button class="ghost" id="joinByCodeBtn">Присоединиться по коду</button>
        <button class="ghost" id="newDirectBtn">+ Личный чат</button>
      </div>

      <div class="sidebar-search">
        <input type="text" id="conversationFilter" placeholder="Поиск беседы или пользователя">
      </div>
      <div class="search-results hidden" id="searchResults"></div>
      <div class="folder-panel" id="folderPanel">
        <div class="folder-panel-header">
          <span>Папки</span>
          <button class="ghost tiny" id="folderCreateBtn">+ Новая</button>
        </div>
        <div class="folder-chips" id="folderChips">
          <button type="button" class="chip active" data-folder="all" id="folderAllBtn">Все беседы</button>
          <div class="folder-chips-list" id="folderList"></div>
        </div>
      </div>
      <div class="conversation-list" id="conversationList"></div>
    </aside>

    <main class="chat">
      <div class="chat-placeholder" id="chatPlaceholder">
        <h1>Pink Talk 2.0</h1>
        <p>Выберите беседу слева или создайте новую. Вы можете делиться кодом беседы, чтобы друзья присоединились в пару кликов.</p>
      </div>

      <section class="chat-pane hidden" id="chatPane">
        <header class="chat-header">
          <div class="chat-title">
            <div class="avatar" id="conversationAvatar"></div>
            <div>
              <h2 id="conversationTitle"></h2>
              <p id="conversationMeta"></p>
              <span class="chat-code">Код беседы: <strong id="conversationCode"></strong> <button class="ghost tiny" data-copy="conversationCode">Скопировать</button></span>
            </div>
          </div>
          <div class="chat-actions">
            <button class="ghost" id="addMemberBtn">Пригласить</button>
            <button class="ghost" id="conversationSettingsBtn">Настройки</button>
            <button class="ghost" id="detailsToggleBtn">Участники</button>
          </div>
        </header>

        <div class="pinned-bar hidden" id="pinnedBar"></div>

        <div class="typing-line hidden" id="typingIndicator"></div>

        <div class="history" id="messageScroller">
          <button class="ghost tiny hidden" id="loadMoreBtn">Показать ранние</button>
          <div class="message-list" id="messageList"></div>
        </div>

        <form class="composer" id="messageForm" autocomplete="off">
          <div class="reply-preview hidden" id="replyPreview">
            <div class="reply-preview-top">
              <span class="reply-preview-label">Ответ на сообщение</span>
              <button type="button" class="ghost tiny" id="replyPreviewClose">×</button>
            </div>
            <div class="reply-preview-body">
              <strong id="replyPreviewAuthor"></strong>
              <p id="replyPreviewText"></p>
            </div>
          </div>
          <div class="attachment-bar hidden" id="attachmentBar"></div>
          <div class="composer-row">
            <div class="composer-actions">
              <label class="attachment-btn" title="Прикрепить файл">
                <input type="file" id="attachmentInput" accept="image/*,audio/*,video/*" hidden>
                📎
              </label>
              <button type="button" class="record-btn" id="voiceRecordBtn" title="Голосовое сообщение">🎤</button>
              <button type="button" class="record-btn" id="circleRecordBtn" title="Кружок (видео)">📹</button>
            </div>
            <textarea id="messageInput" rows="1" maxlength="4000" placeholder="Напишите сообщение..."></textarea>
            <button type="submit" class="primary">Отправить</button>
          </div>
          <input type="file" id="voiceFallbackInput" accept="audio/*" hidden>
          <input type="file" id="circleFallbackInput" accept="video/*" hidden>
          <div class="recording-indicator hidden" id="recordingIndicator">
            <span class="recording-dot"></span>
            <span id="recordingStatus">00:00</span>
            <span id="recordingType" class="recording-type"></span>
            <button type="button" class="ghost tiny" id="recordingStopBtn">Стоп</button>
          </div>
        </form>
      </section>
    </main>

    <aside class="details-panel hidden" id="detailsPanel">
      <div class="details-header">
        <h3>Участники</h3>
        <button class="ghost" id="detailsCloseBtn">×</button>
      </div>
      <div class="details-body">
        <div class="conversation-summary" id="detailsSummary"></div>
        <div class="details-folders hidden" id="detailsFolders"></div>
        <h4 class="details-section-title">Участники</h4>
        <ul class="member-list" id="memberList"></ul>
      </div>
    </aside>
  </div>

  <div class="modal hidden" id="profileModal">
    <div class="modal-content">
      <h2>Настройки профиля</h2>
      <form id="profileForm">
        <div class="profile-avatar-grid">
          <div class="avatar avatar-preview" id="profileAvatarPreview"></div>
          <div class="avatar-upload">
            <label class="ghost file-upload">
              <input type="file" id="profileAvatarInput" accept="image/*" hidden>
              Загрузить фото
            </label>
            <button type="button" class="ghost tiny" id="profileAvatarRemoveBtn">Удалить фото</button>
            <p class="upload-hint">PNG, JPG или WEBP до 10 МБ</p>
          </div>
        </div>
        <label>Имя
          <input type="text" name="displayName" minlength="2" maxlength="60" required>
        </label>
        <label>Статус
          <input type="text" name="statusMessage" maxlength="160" placeholder="Например: На связи">
        </label>
        <label>О себе
          <textarea name="bio" rows="3" maxlength="500" placeholder="Расскажите о себе, чем увлекаетесь"></textarea>
        </label>
        <div class="modal-actions">
          <button type="button" class="ghost" data-close>Отмена</button>
          <button type="submit" class="primary">Сохранить</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal hidden" id="groupModal">
    <div class="modal-content">
      <h2>Новая беседа</h2>
      <form id="groupForm">
        <label>Название
          <input type="text" name="title" minlength="3" maxlength="100" required>
        </label>
        <label>Описание
          <textarea name="description" rows="3" maxlength="500" placeholder="О чём эта беседа?"></textarea>
        </label>
        <label>Участники (логины через запятую)
          <input type="text" name="members" placeholder="user1, user2">
        </label>
        <label class="checkbox">
          <input type="checkbox" name="isPrivate">
          <span>Сделать беседу закрытой</span>
        </label>
        <div class="modal-actions">
          <button type="button" class="ghost" data-close>Отмена</button>
          <button type="submit" class="primary">Создать</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal hidden" id="directModal">
    <div class="modal-content">
      <h2>Новый личный чат</h2>
      <form id="directForm">
        <label>Логин или ID собеседника
          <input type="text" name="username" minlength="3" maxlength="64" required placeholder="Логин или ID">
        </label>
        <div class="modal-actions">
          <button type="button" class="ghost" data-close>Отмена</button>
          <button type="submit" class="primary">Начать</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal hidden" id="joinModal">
    <div class="modal-content">
      <h2>Присоединиться по коду</h2>
      <form id="joinForm">
        <label>Код беседы
          <input type="text" name="code" minlength="5" maxlength="16" required placeholder="C123ABC456">
        </label>
        <div class="modal-actions">
          <button type="button" class="ghost" data-close>Отмена</button>
          <button type="submit" class="primary">Присоединиться</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal hidden" id="memberModal">
    <div class="modal-content member-modal">
      <button type="button" class="ghost tiny modal-close" data-close>×</button>
      <div class="member-modal-header">
        <div class="avatar member-avatar" id="memberProfileAvatar"></div>
        <div class="member-modal-info">
          <h3 id="memberProfileName"></h3>
          <p id="memberProfileStatus"></p>
          <span class="member-modal-presence" id="memberProfilePresence"></span>
        </div>
      </div>
      <p class="member-modal-bio" id="memberProfileBio"></p>
      <div class="member-modal-actions">
        <button type="button" class="primary" id="memberProfileMessageBtn">Написать</button>
        <button type="button" class="ghost" id="memberProfileInviteToggle">Пригласить</button>
        <button type="button" class="ghost" id="memberProfileCopyBtn">Скопировать ID</button>
      </div>
      <div class="member-modal-invite hidden" id="memberProfileInviteSection">
        <label>Беседа
          <select id="memberProfileInviteSelect"></select>
        </label>
        <button type="button" class="primary" id="memberProfileInviteBtn">Отправить</button>
      </div>
    </div>
  </div>

  <div class="media-viewer hidden" id="mediaViewer">
    <div class="media-viewer-backdrop" data-media-close></div>
    <div class="media-viewer-content">
      <button type="button" class="ghost tiny media-viewer-close" data-media-close>×</button>
      <img id="mediaViewerImage" alt="" class="hidden">
      <video id="mediaViewerVideo" controls class="hidden"></video>
      <div class="media-viewer-meta">
        <span id="mediaViewerCaption"></span>
        <a id="mediaViewerDownload" class="ghost tiny" download target="_blank" rel="noreferrer noopener">Скачать</a>
      </div>
    </div>
  </div>

  <div class="modal hidden" id="conversationModal">
    <div class="modal-content conversation-modal">
      <h2>Настройки беседы</h2>
      <form id="conversationForm">
        <div class="conversation-avatar-grid">
          <div class="avatar conversation-avatar" id="conversationAvatarPreview"></div>
          <div class="avatar-upload">
            <label class="ghost file-upload">
              <input type="file" id="conversationAvatarInput" accept="image/*" hidden>
              Загрузить обложку
            </label>
            <button type="button" class="ghost tiny" id="conversationAvatarRemoveBtn">Удалить обложку</button>
          </div>
        </div>
        <label>Название
          <input type="text" id="conversationTitleInput" minlength="3" maxlength="100" required>
        </label>
        <label>Описание
          <textarea id="conversationDescriptionInput" rows="3" maxlength="500" placeholder="Опишите беседу"></textarea>
        </label>
        <div class="modal-actions">
          <button type="button" class="ghost" data-close>Отмена</button>
          <button type="submit" class="primary">Сохранить</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal hidden" id="forwardModal">
    <div class="modal-content">
      <h2>Переслать сообщение</h2>
      <form id="forwardForm">
        <label>Беседа
          <select id="forwardConversationSelect" required></select>
        </label>
        <label>Или логин/ID пользователя
          <input type="text" id="forwardUserInput" placeholder="Например: pinkstar">
        </label>
        <label>Комментарий
          <textarea id="forwardCommentInput" rows="2" maxlength="4000" placeholder="Необязательный текст"></textarea>
        </label>
        <div class="modal-actions">
          <button type="button" class="ghost" data-close>Отмена</button>
          <button type="submit" class="primary">Переслать</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal hidden" id="folderModal">
    <div class="modal-content">
      <h2 id="folderModalTitle">Новая папка</h2>
      <form id="folderForm">
        <label>Название папки
          <input type="text" id="folderTitleInput" minlength="2" maxlength="60" required>
        </label>
        <label>Цвет
          <input type="color" id="folderColorInput" value="#ffacd8">
        </label>
        <div class="modal-actions">
          <button type="button" class="ghost" data-close>Отмена</button>
          <button type="submit" class="primary">Сохранить</button>
        </div>
      </form>
    </div>
  </div>

  <div class="toast hidden" id="toast"></div>
</body>
</html>
